ARG IMAGE
ARG IMAGE_TAG

FROM ${IMAGE}:${IMAGE_TAG}

ARG ENTRYPOINT_COMMAND
ENV ENTRYPOINT_COMMAND_VAR=$ENTRYPOINT_COMMAND

RUN mkdir -p /tmp/prisma-data

RUN mkdir -p /tmp/prisma-data/forensic/defender/db
RUN chmod -R 777 /tmp/prisma-data/forensic

COPY defender /tmp/prisma-data/defender
RUN chmod 555 /tmp/prisma-data/defender

ENV DEFENDER_TYPE="appEmbedded"
ENV FILESYSTEM_MONITORING="true"
ENV WS_ADDRESS="wss://prismacloud.epa.gov:8084"
ENV DATA_FOLDER="/tmp/prisma-data/"
ENV INSTALL_BUNDLE="eyJzZWNyZXRzIjp7ImRlZmVuZGVyLWNhLnBlbSI6Ii0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLVxuTUlJREhEQ0NBZ1NnQXdJQkFnSVFjOXZxdFpzdldKWCtYaTFUTnhmRm5EQU5CZ2txaGtpRzl3MEJBUXNGQURBb1xuTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBeVxuTURreU16QXhNREJhRncweU5qQXlNRGd5TXpBeE1EQmFNQ2d4RWpBUUJnTlZCQW9UQ1ZSM2FYTjBiRzlqYXpFU1xuTUJBR0ExVUVBeE1KVkhkcGMzUnNiMk5yTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ1xuQVFFQTZxRzhCMjhhZGMycHFYTXBjSC9XR2h4T3p4YVhjbTJUbDNYdWg0RkNxRkg4ODZJaVAyQ1hxUlVKcVZwTlxuak5vUDFTZUZLaDN5SXBXc0UrZ2xjaURpRGE5RWdYQVQyN2trenREN3RDNEVtNi9WeFVLZ25jUXZGb3NiNXlFRVxudU5KYU84WGg4ZzZJM1ZVN3N6S3VtYU5qSWlwZkRPdjU3R3ljaFh3S0h6WGJVUmk0ZnBiWmVseC9xUnFsaGVTY1xudXp3NklyNXRvQzkyV1dHNTZzQ0F6cGhKbUNFOTdPcEx3S2ZMbC9SQm1jcW9UOEdTVjhnYjI4MGNud1VqRHd0eFxud0hWRDY2cUZBKzFLbmplWHRqc1o1WFJQMHN1bG5wcjM4SmpSc2dERTlrK3VZUFowV3BNUUdSU1RxVUpCdFcxcVxuVnBCeU1QZkd1ZS9RdVUrUGFwbTh6VHUvcVFJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcXd3RHdZRFxuVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVVyZE9Wc2dCRzJ3Zk91c0NFVmNqRmM1blZNZ1F3RFFZSlxuS29aSWh2Y05BUUVMQlFBRGdnRUJBTEFwUWloelhVdlFZTWZ3S3BrR2NFWnFYRXBmdnF1TnQrd3F0Mk14ZGprN1xuTWk0Q2QxcVl0WjY0eWQ4Vjh6K3J0YkxNSUNGam9vSmsrQ3Q4Tnhja2RwRnppKzAweXhwODB0SlZrcTNmQlo2U1xuWmF0NXZjMW1oUUQ2QzU0Z0Y2bVp1WGJybWx6MEJwZzdvQTFDNEVxWXpVSlZGdTZORk1YeDBaaXMyQlFsYXp4U1xuRklIU1d4cGNBZGZzcnlIdzk0NUpkaUdWYzV4bDk0Tmc5L3BrcHlzaE5HV0VuU0hCbTFNT2NvT1BaMCsweFhDVFxuTTE5VVV4RHR6a3VWQ2pUSTdRTHJQdHJ3RlpIUVNGYklwWHJmL21hckw4c1FzMjM1QnZjTG1DZHpyYWtYUjZRYlxucHVUeEE1cERWQ0NqbWJxWEJ2TjB5N0s5Ukd3alNkSTZMOVdidXFYbTdIVT1cbi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS1cbiIsImRlZmVuZGVyLWNsaWVudC1jZXJ0LnBlbSI6Ii0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLVxuTUlJRFBEQ0NBaVNnQXdJQkFnSVJBSkZMUWFMeFZtVkVNUGZHcDhsa2VHa3dEUVlKS29aSWh2Y05BUUVMQlFBd1xuS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpRd1xuTXpBNU1UWXhOREF3V2hjTk1qY3dNekE1TVRZeE5EQXdXakFvTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeFxuRWpBUUJnTlZCQU1UQ1d4dlkyRnNhRzl6ZERDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ1xuZ2dFQkFLMXp5NUV4SDZ4QW1FREpmYS8yWWNSaURWdTJUb05TSUJ3VC9MM0VrQmtOL0czd1VhMnhyNTlRS2lENlxuQXB3ZysxVStPdlNmMGNmZEhiTUxwM1dRZGgrR2ppSTZDMlM0bG9Fb1JvdERMQUdEWFJIVEZGOG45enR0UjV6TlxuVnRnSTE1WXpFS3V2ekR1YVBPZHZvU3dXSXpuUlRWZFFJSzVHV1poS1d4S1FkSS9xcGVkNkZmOS8wZG0yT3E4aVxuSSthQjNoU3dRQm9pWXdzeVJEWGNuM1RsTDZmeEZUNU83QUJtQzRVUGtnVXJVbEVGS0pmSUMveExZSTk3bU9iSVxuTU1WZkF2SEVSU2t1UFdDR3JJN3pDTWxxK1I3Z2N3TVZBR3FOWVJhb3ZZVWxXOGJETlNES3l0MXFiV3RJY2IreVxua0pVSi9ESHlzMENhSzZDL1dzN0FVU3Y1d3dzQ0F3RUFBYU5oTUY4d0RnWURWUjBQQVFIL0JBUURBZ2VBTUJNR1xuQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVcmRPVlxuc2dCRzJ3Zk91c0NFVmNqRmM1blZNZ1F3Q1FZRktnUUJBZ2NFQURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQVxuQWhvYzhJL1VzSlhpemdkTDVneTNtaVFBU1MvV3VsZWV6TkNMRVl6eFMxZ0dFby9tckFOUGtuc0NXSnRzWXNIN1xuTnNEZXM1MEVMUFYrL24yeDR6dlZyUlR1VlU1bHJjYkxKeDhGM2hOOUNZb3pRTGs5cFRrY0xEanl1by9jTENmcFxuZ1VyQ2V2eVNuQmZ5M3lGYUpmWk1NVjFmcVgrWkxQU1hORzhBQ2RWZnR6UWl6VTlsejJzWFNsOGo5UVd3S2FaZlxuQzRFSm04eVhreFVONStYblRJRWNwZjFqYXp0OUExMnFoaGJJNUVhMEswdEVjeE1Mak5GNmF0Uzhvay9Qd2FaWlxuR05oTDlxOWpVNEhCRVpZSFRoN1VmeDBDbHFVU3poS2YwRUNtMXRzYmFsa3o2SEd1WDlWUHJ1d0tEWjdpc3NaWFxuSEFUYk9mUkFOdWM3QTRoRXRabUpEUT09XG4tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tXG4iLCJkZWZlbmRlci1jbGllbnQta2V5LnBlbSI6Ii0tLS0tQkVHSU4gUlNBIFBSSVZBVEUgS0VZLS0tLS1cblByb2MtVHlwZTogNCxFTkNSWVBURURcbkRFSy1JbmZvOiBBRVMtMjU2LUNCQywyMzQ4YTA1MTM4YmE5MDA5OGJlOTZkYjFjZTc5MWQ0ZlxuXG40RzQ4RFIyMHlQZml2eWVjTENHSGhZYWZzbHVyenh3Z0pBK3VwOFc0MnJLeStPczliZ2FNTHY1MEgxdjdpVXlJXG5LbUcxZ0gxa0pqMUZod3dFbzQ3ZTJjOWpUSHdBMXNHL1VPVUJLQVFQNlI1MzFEMk5QbWZVZE80UnVjcTk3MTRnXG5aeGxmQjZvWkFwMFgrMzJEdFBqRHYvZmZ4K2t5by9RZHltcVBjTGJOZTd6OUVpNTN2MHhTNUhvTWxSRWlIN1g2XG5MdmRnamhvVEdvRCswZzJYY1hBbU9CNEphVmROZzdKSjRqVHRPaFlSZzhMeDNIaGVRdDFrcWVVZ3hNQzczSXQ1XG5ORUoyS1dndmxIb2Y3L0t6amhLaXNTQ29qa0txRzdKV294bzEwNjFEeEdOWHVwclpVdjIvVWk3OGJEajhkWjFKXG5yVXZZYTNNMkZqWDB4ZENLdk5hSEVZemx2OWw5YjdhODlmeE9QTUhqcjZVMC9vOXlXMklXV0FhRnFOZm9qNjZXXG5yemovMDBvbnBIZmZFbFVtWTVjaUllQk00L01ISFJBSkwxU0pjdUdmenNzTWpBQlVqR0lnenNoQ1NkMGVpd0hjXG55dSt1OHpUajd1UW9GZERDSEtady80M2hDc1FBN0tVeE40ZmRGTHliVlpJRUVZUGdIWlNmYkdGUHgvRUZmTEZXXG5NOTJrVHkxSjh2TWJ4TG1FbkZaN0ZZRGJ0OGpGOUJwaFVOUm8rVjN5N2ZpK2pKbkVtcDZ5aHFtdENUSmpHby9rXG55ellpK3ZhUHkxeGpnNlNkUlc4ZGdwMkVSTlVkWFBPdk1uRko0MnY4UHZHTXl2TTJhUEVFWVQvcnNFSVdVeGVPXG53eDRVbTdDU2ZUMHY1TVNJZnRpZXdVSHk0c09FMDVUOHZJMVpVMUh0YTVCSHR5dzlDZ2tIN1hybmg1Y21ScEJkXG5RZ09NVjFDNk9VUzcwRysxMG9tQytLRTJIK1dENDNJaFpUc0kvdTZaT3k4b09SQSthZWdEVVN4UmpQMVZhRmtxXG5HZjkremxvQ1NmbXlOYjljUGJLa1pudzJMQ2NyVXlONVpWTXJCejliZkJyKy9Sb2hQckZMbjZGdG1TTkRrMC9WXG5oSXJONTBSckV4eEpxZlYvQk9hanBNcnRoOHJxRm1BR2JnYTJsRjJsZ1dNVkVtc25QalNaVFhrOVpXMWt3dnpQXG43UWpTNGJwSThxeHVHMnlHNytFQ0JLOU1WMGxHUDNweGJjREp1QzRhY2VPWkd4Kzc3RHNDOHBvcHNKaGZwZG5uXG5ua1RrcGxiYXZqa0FKdVVGWlNJTUdzRjVHd29oU2VqYWZNc3lCZFBBczFOeVNKd0dPeTlSeUd4dkNOSjM0Zi9WXG5xK05PSXNFRWVteEVzN1ZXUi82cWVIeFZFMTJWZkZoaTcyWnRQNkxra1F0WXE1UnpBYk5oTHprZDV3YVhSNlZrXG4rMFdPVFZ3WHJmMWJnVjlRTzE2Nk9uTTFKY1hIaHJpVS9qdC8wa0I0dEh6cHdPRXhzM2xZVEZFdFBtalhtcURnXG4zOU1NQnA5NWxES2NIakJxcGRCNmVZRExjMGF0L0cxOTVRNUo2UFMrR1JlT05OY1RNWVIwd1VuMWxtYlJDSVFIXG5WZmV6b215bENXVkU2MmViVVlUZnVES1JJeDRzdkFlYzNKZkVZSWl0cFRuY3pZL3VtZ3UwOEs5TVIxZSszQit1XG5Jb1FHczRQdmNUQ2lnL2F5UnUzSkJEOXlXMFBPeEdPcFBIR0xoajdCZUNLZ0lFTVg0a3I4RjU5SE16RThZekRtXG44S0E5VEt3Z2JBVE4xM0dFb2pGYnRCQjVoWDRNOFowV1h4QUp2a3d6bGU5OUdiSkU0cFRleG1kd1k3d2RteVQ1XG5BdkF4THBWK2hvSGI5eUlIbW1kZCtDRElrNFJtbjN3VTcxY3ltTzJ3dEtqTnpSZ3o4RDVLZ3VrVkprQVA2SUpKXG4ya0krejY0OWJXZEpFOVFjNG9yNzh6aDRWemtLcjQ2UHd2MTVYOEt6R1VHRDYyREtGcStDbThwMk41UmRycFYxXG5QM0dRV2hHcFU3Y3FhNnN4U2F2TEtCV1B5MzAzSnROclROSVM0dFhRY1QxV3hxUmRGMWpkVXIrQUJ3bEU5WWdLXG4tLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLVxuIiwic2VydmljZS1wYXJhbWV0ZXIiOiJzWndKRDREc3djdno4T3A2eklVTnByb295ZnNpaGloTUVSblE2RFRheVppYTR6cUJMY3FVbjI3bDBnVERRYlMrNzJ4aTBRRGVjZGJPSEFZa1pYTElNdz09In0sImdsb2JhbFByb3h5T3B0Ijp7Imh0dHBQcm94eSI6IiIsIm5vUHJveHkiOiIiLCJjYSI6IiIsInVzZXIiOiIiLCJwYXNzd29yZCI6eyJlbmNyeXB0ZWQiOiIifX0sIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2UsImltYWdlU2NhbklEIjoiNzA1NzlmZTItMDI3Zi03NGU0LTA4N2EtOGRiOGVlMmYwNGQ0In0="

# This must be set in the manifest of the workload, as it does change per-environment. The container image must not change per-environment.
# ENV DEFENDER_APP_ID="<unique identifier of your application>"

COPY entrypoint.sh entrypoint.sh
RUN chmod 555 entrypoint.sh

ENTRYPOINT ./entrypoint.sh
