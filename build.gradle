
plugins {
    id 'java-library'
}

sourceCompatibility = 17
targetCompatibility = 17

repositories {
    mavenCentral()
}

dependencies {

	implementation 'com.sparkjava:spark-core:2.9.3'
	constraints {
        implementation('org.eclipse.jetty:jetty-server:9.4.44.v20210927') {
            because 'Previous versions have security vulnerabilities'
        }
       implementation('org.eclipse.jetty:jetty-webapp:9.4.44.v20210927') {
            because 'Previous versions have security vulnerabilities'
        }
       implementation('commons-beanutils:commons-beanutils:1.9.4') {
            because 'Previous versions have security vulnerabilities'
        }
    }
    
	implementation 'org.pac4j:spark-pac4j:5.0.0'
	implementation 'org.pac4j:pac4j-http:5.4.3'

	// database related
	
	implementation 'org.postgresql:postgresql:42.3.1'
	
	implementation 'com.h2database:h2:1.4.199'
	implementation 'org.jooq:jooq:3.15.5'
	implementation 'p6spy:p6spy:3.8.2'
	implementation 'com.zaxxer:HikariCP:4.0.3'

	implementation 'io.dropwizard.metrics:metrics-core:4.2.0'
	implementation 'io.dropwizard.metrics:metrics-jvm:4.2.0'
	implementation 'io.dropwizard.metrics:metrics-healthchecks:4.2.0'
	implementation 'io.dropwizard.metrics:metrics-jmx:4.2.0'

	implementation 'com.fasterxml.jackson.core:jackson-core:2.12.3'
	implementation 'com.fasterxml.jackson.core:jackson-databind:2.12.3'
	implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.12.3'

	implementation 'io.vavr:vavr:0.10.0'
	implementation 'org.slf4j:slf4j-api:1.7.26'
	implementation 'ch.qos.logback:logback-classic:1.2.3'
	implementation 'commons-cli:commons-cli:1.4'
	implementation 'com.opencsv:opencsv:4.6'
	implementation 'org.apache.commons:commons-lang3:3.9'
	implementation 'org.apache.poi:poi:4.1.0'
	implementation 'org.apache.poi:poi-ooxml:4.1.0'
	implementation 'com.squareup.tape2:tape:2.0.0-beta1'
	implementation 'org.quartz-scheduler:quartz:2.3.1'

    implementation 'org.mariuszgromada.math:MathParser.org-mXparser:5.0.7'
    
    implementation 'io.kubernetes:client-java-extended:14.0.0'

}

task fatJar(type: Jar) {
    duplicatesStrategy = 'include'

	manifest {
		attributes 'Main-Class': 'gov.epa.bencloud.server.BenCloudServer'
    }
	
	exclude 'META-INF/*.RSA', 'META-INF/*.SF', 'META-INF/*.DSA'

	archiveBaseName = "BenCloudServer"
	from { configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
	with jar
}

task taskRunnerFatJar(type: Jar) {
    duplicatesStrategy = 'include'

	manifest {
		attributes 'Main-Class': 'gov.epa.bencloud.server.BenCloudTaskRunner'
    }
	
	exclude 'META-INF/*.RSA', 'META-INF/*.SF', 'META-INF/*.DSA'

	archiveBaseName = "BenCloudTaskRunner"
	from { configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
	with jar
}
